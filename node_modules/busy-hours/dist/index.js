'use strict';var _Promise='undefined'==typeof Promise?require('es6-promise').Promise:Promise,fetch=require('axios');async function busy_hours(a,b){if(!(a&&b))return{status:'error',message:'Place ID / API key missing'};var c=require('@google/maps').createClient({key:b,Promise:_Promise}),d=function(a){return{hour:a[0],percentage:a[1]}},e=function(a){var b=['APP_INITIALIZATION_STATE=','window.APP_FLAGS'],c=a.substring(a.lastIndexOf(b[0])+b[0].length,a.lastIndexOf(b[1])),d=eval(c),e=eval(d[3][6].replace(')]}\'',''));return e[0][1][0][14][84]},f=function(a){var b=e(a);if(!b)return{status:'error',message:'Place has no popular hours'};var c={status:'ok'},f=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];c.week=Array.from(Array(7).keys()).map(function(a){var c=[];return b[0][a]&&b[0][a][1]&&(c=Array.from(b[0][a][1]).map(function(a){return d(a)})),{day:f[a],hours:c}});var g=b[7];return void 0!==g&&(c.now=d(g)),c},g=async function(a){try{var b=await fetch({url:a,headers:{"User-Agent":'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.108 Safari/537.36'}});return b.data}catch(a){return{status:'error',message:'Invalid url'}}};try{var h=await c.place({placeid:a}).asPromise(),i=h.json.result,j=i.name,k=i.formatted_address,l=i.geometry.location,m=await g(i.url);return Object.assign({name:j,formatted_address:k,location:l},f(m))}catch(a){return{status:'error',message:'Error: '+a.json.status||a}}}module.exports=busy_hours;